version: "1.0"
namespace: wippy.embeddings

entries:
  # Dependencies
  - name: __dependency.wippy.llm
    kind: "ns.dependency"
    meta:
      description: "LLM component"
    component: "wippy/llm"
    version: ">=v0.0.7"

  - name: __dependency.wippy.migration
    kind: "ns.dependency"
    meta:
      description: "Migration component"
    component: "wippy/migration"
    version: ">=v0.0.7"

  - name: __dependency.wippy.test
    kind: "ns.dependency"
    meta:
      description: "Testing component"
    component: "wippy/test"
    version: ">=v0.0.7"

  # Requirements
  - name: APP_DB
    kind: ns.requirement
    meta:
      description: "Application database resource identifier"
    targets:
      - entry: embedding_repo
        path: .meta.target_db
      - entry: wippy.embeddings.migrations:01_create_embeddings_table
        path: ".meta.target_db"

  # wippy.embeddings:embedding_repo
  - name: embedding_repo
    kind: library.lua
    meta:
      comment: Repository for persisting vector embeddings
      tags:
        - vector
        - embeddings
        - persistence
        - storage
      description: Universal embedding storage and retrieval system for both PostgreSQL and SQLite
      depends_on:
        - ns:wippy.sql
    source: file://embedding_repo.lua
    modules:
      - sql
      - json
      - uuid
      - time

  # wippy.embeddings:embedding_repo_test
  - name: embedding_repo_test
    kind: function.lua
    meta:
      name: Embedding Repository Test
      type: test
      comment: Tests the embedding_repo library for vector operations
      group: Embedding Tests
      tags:
        - embeddings
        - vector
        - tests
      depends_on:
        - wippy.embeddings:embedding_repo
    source: file://embedding_repo_test.lua
    modules:
      - sql
      - uuid
      - json
    imports:
      embedding_repo: wippy.embeddings:embedding_repo
      test: wippy.test:test
    method: run_tests

  # wippy.embeddings:embeddings
  - name: embeddings
    kind: library.lua
    meta:
      comment: Vector embedding generation and search utilities
      tags:
        - vector
        - embeddings
        - search
        - ai
      description: System for generating, managing and searching vector embeddings with token management
      depends_on:
        - ns:wippy.llm
        - wippy.embeddings:embedding_repo
    source: file://embeddings.lua
    imports:
      embedding_repo: wippy.embeddings:embedding_repo
      llm: wippy.llm:llm
